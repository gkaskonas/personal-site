---
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { calculateReadingTime } from "@/lib/utils";

interface Props {
  post: CollectionEntry<"blog">;
  featured?: boolean;
  index?: number;
}

const { post, featured = false, index = 0 } = Astro.props;

const formattedDate = new Date(post.data.date).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});

const readingTime = calculateReadingTime(post.body || "");
---

<article
  class:list={[
    "blog-card group relative overflow-hidden rounded-2xl",
    "bg-white dark:bg-gray-900/80",
    "border border-gray-200 dark:border-gray-800",
    "card-glow transition-all duration-500",
    "hover:-translate-y-1",
    featured && "md:col-span-2",
  ]}
  style={`--animation-delay: ${index * 100}ms`}
>
  {/* Animated accent line */}
  <div
    class="absolute top-0 left-0 h-1 w-0 bg-gradient-to-r from-primary to-primary/50 transition-all duration-500 group-hover:w-full z-10"
  >
  </div>

  <a href={`/blog/${post.id}`} class="block h-full">
    {/* Image Container */}
    <div
      class:list={[
        "relative w-full overflow-hidden",
        featured ? "aspect-[21/9]" : "aspect-[16/10]",
      ]}
    >
      <Image
        src={post.data.coverImage}
        alt={post.data.title}
        class="h-full w-full object-cover transition-transform duration-700 group-hover:scale-105"
        loading="lazy"
        quality={80}
      />
      {/* Gradient overlay */}
      <div
        class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 transition-opacity duration-500 group-hover:opacity-100"
      >
      </div>

      {/* Arrow icon on hover */}
      <div
        class="absolute top-4 right-4 rounded-full bg-white/90 dark:bg-gray-900/90 p-2.5 opacity-0 transform translate-x-2 -translate-y-2 transition-all duration-500 group-hover:opacity-100 group-hover:translate-x-0 group-hover:translate-y-0"
      >
        <svg
          class="h-4 w-4 text-primary"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M7 17L17 7M17 7H7M17 7v10"></path>
        </svg>
      </div>

      {/* Featured badge */}
      {
        featured && (
          <div class="absolute top-4 left-4">
            <span class="px-3 py-1.5 text-xs font-semibold bg-primary text-white rounded-full">
              Featured
            </span>
          </div>
        )
      }
    </div>

    {/* Content */}
    <div class:list={["p-6", featured && "md:p-8"]}>
      {/* Meta info */}
      <div
        class="mb-3 flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400"
      >
        <span>{formattedDate}</span>
        <span class="h-1 w-1 rounded-full bg-gray-300 dark:bg-gray-600"></span>
        <span class="flex items-center gap-1.5">
          <svg
            class="h-3.5 w-3.5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          {readingTime}
        </span>
      </div>

      {/* Title */}
      <h2
        class:list={[
          "font-bold text-gray-900 dark:text-white",
          "transition-colors duration-300 group-hover:text-primary",
          featured ? "text-2xl md:text-3xl mb-4" : "text-xl mb-3",
        ]}
      >
        {post.data.title}
      </h2>

      {/* Excerpt */}
      <p
        class:list={[
          "text-gray-600 dark:text-gray-300",
          featured ? "line-clamp-3 text-base" : "line-clamp-2 text-sm",
        ]}
      >
        {post.data.excerpt}
      </p>

      {/* Tags */}
      {
        post.data.tags && post.data.tags.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {post.data.tags.slice(0, featured ? 5 : 3).map((tag) => (
              <span class="rounded-full px-3 py-1 text-xs font-medium border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 transition-colors duration-300 group-hover:border-primary/50 group-hover:text-primary">
                {tag}
              </span>
            ))}
          </div>
        )
      }

      {/* Author - shown on featured cards */}
      {
        featured && (
          <div class="mt-6 pt-4 border-t border-gray-100 dark:border-gray-800 flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-primary to-primary/50 flex items-center justify-center text-white text-sm font-bold">
              {post.data.author.charAt(0)}
            </div>
            <span class="text-sm text-gray-600 dark:text-gray-400">
              {post.data.author}
            </span>
          </div>
        )
      }
    </div>
  </a>
</article>

<style>
  .blog-card {
    animation: slideUp 0.6s ease-out forwards;
    animation-delay: var(--animation-delay);
    opacity: 0;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .blog-card {
      animation: none;
      opacity: 1;
    }
  }
</style>
